(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system_set-account-account_add_edit"],{"2d27":function(e,t,r){"use strict";r("7a82");var a=r("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("d9e2"),r("d401"),r("d3b7"),r("159b"),r("7db0"),r("14d9");var n=a(r("c7eb")),o=a(r("1da1")),l=a(r("f554")),i={data:function(){var e=this,t=function(){var t=(0,o.default)((0,n.default)().mark((function t(r,a,o){var l;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return",o(new Error("请输入账号")));case 2:return t.next=4,e.$db["uni-id-users"].field("username").where({_id:e.$db.$cmd.neq(e.dataId),username:a}).tofirst({loadding:!1});case 4:if(l=t.sent,!l.datas){t.next=8;break}return o(new Error(a+" 账号已存在")),t.abrupt("return");case 8:o();case 9:case"end":return t.stop()}}),t)})));return function(e,r,a){return t.apply(this,arguments)}}();return{dataId:"",roleOptions:[],role:[],form:{username:"",password:"",role:[],gender:"0",avatar:"",mobile:"",comment:"",status:0},imageValue:null,imageStyle:{height:"150px",width:"150px"},rules:{username:[{required:!0,validator:t,trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"change"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]}}},methods:{loadData:function(){var e=this;return(0,o.default)((0,n.default)().mark((function t(){return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$db["uni-id-roles"].tolist({page:1,rows:500}).then((function(t){200==t.code&&(e.roleOptions=t.datas)}));case 2:if(e.dataId){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.$db["uni-id-users"].field("username, role, gender, avatar, mobile, comment, status").tofirst(e.dataId).then((function(t){if(200==t.code){for(var r in e.form)e.form[r]=t.datas[r];e.roleOptions.forEach((function(r){t.datas.role.find((function(e){return e==r.role_id}))&&e.role.push(r.role_id)})),e.form.avatar&&(e.imageValue={},e.imageValue.url=e.form.avatar)}}));case 6:case"end":return t.stop()}}),t)})))()},submitForm:function(e){var t=this;this.$refs[e].validate((function(e,r){if(t.$api.set_unvalidated_form_focus(t,r),e)if(t.dataId){delete t.form.password;var a=uni.getStorageSync("useadmin_user");t.form.dataId=t.dataId,t.$func.useadmin.call("user/edit",t.form).then((function(e){200==e.code&&(a._id==t.dataId&&(a.avatar=t.form.avatar,uni.setStorageSync("useadmin_user",a),l.default.$emit("setUserMsg")),t.getOpenerEventChannel().emit("loadData"),t.returnPage())}))}else t.$func.useadmin.call("user/add",t.form).then((function(e){200==e.code&&(t.getOpenerEventChannel().emit("loadData"),t.returnPage())}))}))},roleAdd:function(){var e=this;this.form.role=[],this.roleOptions.forEach((function(t){e.role.find((function(e){return e==t.role_id}))&&e.form.role.push(t.role_id)}))},imgUpload:function(e){this.form.avatar=e.tempFilePaths[0]},imgDelete:function(){this.imageValue=null,this.form.avatar=""},returnPage:function(){l.default.$emit("closeTab"),this.$router.push("/pages/system_set/account/account")}},created:function(){this.dataId=this.$route.query.id||"",this.loadData()}};t.default=i},"75bc":function(e,t,r){"use strict";r.r(t);var a=r("e854"),n=r("da51");for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);var l=r("f0c5"),i=Object(l["a"])(n["default"],a["b"],a["c"],!1,null,"3bbb9be7",null,!1,a["a"],void 0);t["default"]=i.exports},da51:function(e,t,r){"use strict";r.r(t);var a=r("2d27"),n=r.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a},e854:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return a}));var a={uniFilePicker:r("8ba3").default},n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container add_edit"},[r("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{ref:"username",attrs:{label:"账号",prop:"username"}},[r("el-input",{attrs:{placeholder:"请输入账号",clearable:!0},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),""===e.dataId?r("el-form-item",{ref:"password",attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{"show-password":!0,placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e(),r("el-form-item",{ref:"role",attrs:{label:"角色",prop:"role"}},[r("el-select",{staticClass:"sele",attrs:{multiple:!0},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.roleAdd.apply(void 0,arguments)}},model:{value:e.role,callback:function(t){e.role=t},expression:"role"}},e._l(e.roleOptions,(function(e,t){return r("el-option",{key:t,attrs:{label:e.role_id,value:e.role_id}})})),1),r("div",{staticClass:"remark_txt"},[e._v("用户可拥有多种角色")])],1),r("el-form-item",{attrs:{label:"性别"}},[r("el-radio",{attrs:{label:"0"},model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[e._v("未知")]),r("el-radio",{attrs:{label:"1"},model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[e._v("男")]),r("el-radio",{attrs:{label:"2"},model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[e._v("女")])],1),r("el-form-item",{attrs:{label:"头像"}},[r("uni-file-picker",{attrs:{fileMediatype:"image",returnType:"object","image-styles":e.imageStyle},on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.imgUpload.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.imgDelete.apply(void 0,arguments)}},model:{value:e.imageValue,callback:function(t){e.imageValue=t},expression:"imageValue"}})],1),r("el-form-item",{attrs:{label:"手机号"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入手机号",clearable:!0},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{placeholder:"请输入备注",clearable:!0},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1),r("el-form-item",{attrs:{label:"状态"}},[r("el-switch",{attrs:{"active-color":"#ff6a6c","inactive-color":"#bbb","active-value":0,"inactive-value":1},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1),r("el-form-item",[r("el-button",{staticClass:"confirm_btn",attrs:{round:!0,icon:"el-icon-check"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitForm("ruleForm")}}},[e._v("提交")]),r("el-button",{attrs:{round:!0,icon:"el-icon-back"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.returnPage.apply(void 0,arguments)}}},[e._v("返回")])],1)],1)],1)},o=[]}}]);